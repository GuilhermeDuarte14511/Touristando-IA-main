<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Touristando IA — Gerador de Roteiro</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
  <!-- Animate.css -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <!-- AOS (Animate On Scroll) -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

  <style>
    :root{
      --bg1:#0b0d14; --bg2:#10152a; --card:#151a2e; --muted:#e5e8ffcc;
      --primary:#8ea0ff; --primary-2:#5a6bff; --accent:#00e0b8;
      --border:#2a3252; --success:#00d98b; --danger:#ff637d;
    }
    .card{
      color: white;
    }
    html,body{height:100%}
    body{
      color:#fff;
      background:
        radial-gradient(1200px 800px at 10% -10%, #1c2142 0%, transparent 60%),
        radial-gradient(900px 700px at 110% 10%, #1b2a52 0%, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      background-attachment: fixed;
    }

    /* ==== força todos os textos a ficarem brancos ==== */
    a, a:hover, a:focus { color:#fff; text-decoration: underline dotted; }
    .text-secondary, .text-muted, .text-body-secondary,
    .form-text, .link-secondary, .text-white-50,
    .small, small, .tiny, .badge, label { color:#fff !important; }
    /* markdown */
    .md-out{ color:#fff }
    .md-out a{ color:#fff; text-decoration: underline }
    .md-out code, .md-out pre { color:#fff; background:#0e1326; border-radius:8px; }
    .md-out pre{ padding:12px; overflow:auto; }

    /* HERO */
    .hero{ position:relative; overflow:hidden; border-bottom:1px solid var(--border);
      background: linear-gradient(120deg,#1b1f36 0%, #171b30 40%, #111528 100%); }
    .hero::after{ content:""; position:absolute; inset:-40% -40% auto -40%; height:220%;
      background:conic-gradient(from 90deg, rgba(124,140,255,.22), rgba(0,224,184,.14), rgba(124,140,255,.22));
      filter: blur(60px); animation:spin 18s linear infinite; pointer-events:none; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .glass{ background: rgba(255,255,255,.03); border:1px solid var(--border);
      backdrop-filter: blur(8px); box-shadow: 0 8px 40px rgba(0,0,0,.25); border-radius: 18px; }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px }
    .form-control,.form-select{ background:#0e1326; border-color:#243054; color:#fff }
    .form-control::placeholder{ color:#ffffffcc } /* placeholders mais claros */
    .form-control:focus,.form-select:focus{ border-color:var(--primary); box-shadow:0 0 0 .2rem rgba(124,140,255,.2) }
    .btn-primary{ background-image: linear-gradient(135deg,var(--primary),var(--primary-2)); border:0; color:#0b0d14 }
    .btn-primary:hover{ filter:brightness(1.08) }
    .btn-outline-light{ border-color:#35406a; color:#fff }
    .btn-outline-light:hover{ background:#35406a; color:#fff }

    .tiny{ font-size:.88rem }

    /* TAGS */
    .tag{ display:inline-flex; align-items:center; gap:.5rem; padding:.25rem .6rem; border-radius:999px;
      background:#0e1429; border:1px solid #263152; color:#fff; font-size:.8rem; }

    /* LOADER */
    .loader{ --size: 38px; width: var(--size); height: var(--size); border-radius: 50%;
      border: 3px solid rgba(124,140,255,.22); border-top-color: var(--accent); animation: spin 1s linear infinite; }
    .pulse-dot{ width:10px;height:10px;border-radius:50%;background:var(--accent);
      box-shadow:0 0 0 0 rgba(0,224,184,.6); animation:pulse 1.6s infinite; }
    @keyframes pulse{ 0%{box-shadow:0 0 0 0 rgba(0,224,184,.6)} 70%{box-shadow:0 0 0 12px rgba(0,224,184,0)} 100%{box-shadow:0 0 0 0 rgba(0,224,184,0)} }

    /* SKELETON */
    .skeleton{ position:relative; overflow:hidden; border-radius:12px; background:#0f1324; border:1px solid #1c2442 }
    .skeleton::after{ content:""; position:absolute; inset:0; transform: translateX(-100%);
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);
      animation: shimmer 1.6s infinite; }
    @keyframes shimmer{ 100%{ transform: translateX(100%); } }
    .sk-line{ height: 14px; background:#121739; margin:10px 12px; border-radius:6px }
    .sk-line.thick{ height:22px }
    .sk-line.short{ width:65% } .sk-line.mid{ width:85% }

    .toolbar .btn{ border-radius:10px }

    .progress.fake .progress-bar{
      background: linear-gradient(90deg,var(--accent), var(--primary));
      animation: gradientMove 2s linear infinite;
    }
    @keyframes gradientMove{0%{background-position:0 0}100%{background-position:200% 0}}

    /* WIZARD */
    .stepper { display:flex; gap:14px; align-items:center; margin-bottom:12px }
    .step-dot{ width:30px;height:30px;border-radius:50%; display:grid; place-items:center;
      background:#0e1429; border:1px solid #2a3358; color:#b9c4ff; font-weight:700; }
    .step-dot.active{ background:linear-gradient(135deg, var(--primary), var(--primary-2)); color:#0e1122; }
    .step-line{ flex:1; height:2px; background:#22305a; }
    .step-title{ font-weight:700; }

    /* Floating back to top */
    #backTop{ position:fixed; right:18px; bottom:18px; z-index: 10; display:none; }

    .hidden{ display:none !important; }

    /* Motion reduce */
    @media (prefers-reduced-motion: reduce){
      .animate__animated{ animation: none !important; }
      .progress-bar{ animation: none !important; }
    }
  </style>
</head>

<body>
  <!-- HERO -->
  <section class="hero py-5">
    <div class="container">
      <div class="row align-items-center g-4">
        <div class="col-lg-7" data-aos="fade-up">
          <div class="glass p-4 p-md-5">
            <div class="d-flex align-items-center gap-3 mb-2">
              <div class="pulse-dot"></div>
              <span class="text-uppercase tiny">Touristando IA</span>
            </div>
            <h1 class="display-5 fw-bold mb-2">
              <i class="fa-solid fa-earth-americas me-2 text-info"></i>
              Roteiros inteligentes, prontos em segundos
            </h1>
            <p class="lead mb-0">
              Responda às perguntas passo a passo. No final, a IA gera um plano com custos estimados, roteiro dia a dia e dicas.
            </p>
          </div>
        </div>
        <div class="col-lg-5 text-center" data-aos="fade-left" data-aos-delay="150">
          <div class="loader mx-auto my-3"></div>
          <div class="tiny">Geração via endpoint seguro <code>/api/roteiro</code></div>
        </div>
      </div>
    </div>
  </section>

  <!-- MAIN -->
  <main class="container my-5">
    <div class="row g-4">
      <!-- WIZARD -->
      <div class="col-lg-5" data-aos="fade-up">
        <div class="card p-3 p-md-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="step-title"><i class="fa-solid fa-sliders me-2 text-primary"></i>Assistente de Roteiro</div>
            <div class="tiny"><span id="stepNow">1</span>/<span id="stepTotal">6</span></div>
          </div>

          <div class="stepper mb-3">
            <div class="step-dot" data-step="1">1</div><div class="step-line"></div>
            <div class="step-dot" data-step="2">2</div><div class="step-line"></div>
            <div class="step-dot" data-step="3">3</div><div class="step-line"></div>
            <div class="step-dot" data-step="4">4</div><div class="step-line"></div>
            <div class="step-dot" data-step="5">5</div><div class="step-line"></div>
            <div class="step-dot" data-step="6">6</div>
          </div>

          <div class="progress fake mb-3" aria-hidden="true">
            <div id="progressBar" class="progress-bar progress-bar-striped progress-bar-animated" style="width:16%"></div>
          </div>

          <form id="wizard" class="row g-3" autocomplete="off">
            <!-- STEP 1 -->
            <div class="step" data-step="1">
              <label class="form-label">Passo 1 — Para onde você quer ir?</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent text-secondary"><i class="fa-solid fa-flag"></i></span>
                <input id="pais" class="form-control" placeholder="Portugal" required>
              </div>
              <div class="form-text tiny">Pode ser “Portugal”, “Europa”, “Sudeste Asiático”…</div>
            </div>

            <!-- STEP 2 -->
            <div class="step hidden" data-step="2">
              <label class="form-label">Passo 2 — Quantos dias?</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent text-secondary"><i class="fa-regular fa-calendar"></i></span>
                <input id="dias" type="number" class="form-control" value="5" min="1">
              </div>
            </div>

            <!-- STEP 3 -->
            <div class="step hidden" data-step="3">
              <label class="form-label">Passo 3 — Orçamento total (BRL) <span class="tiny">(opcional)</span></label>
              <div class="input-group">
                <span class="input-group-text bg-transparent text-secondary"><i class="fa-solid fa-coins"></i></span>
                <input id="orcamento" type="number" class="form-control" placeholder="3500">
              </div>
              <div class="form-text tiny">Se deixar vazio, usamos faixas típicas do destino.</div>
            </div>

            <!-- STEP 4 -->
            <div class="step hidden" data-step="4">
              <label class="form-label">Passo 4 — Qual seu perfil?</label>
              <div class="input-group">
                <span class="input-group-text bg-transparent text-secondary"><i class="fa-solid fa-person-walking-luggage"></i></span>
                <select id="perfil" class="form-select">
                  <option value="econômico">Econômico</option>
                  <option value="normal" selected>Normal</option>
                  <option value="conforto">Conforto</option>
                </select>
              </div>
            </div>

            <!-- STEP 5 -->
            <div class="step hidden" data-step="5">
              <label class="form-label">Passo 5 — Enviar por e-mail <span class="tiny">(opcional)</span></label>
              <div class="input-group">
                <span class="input-group-text bg-transparent text-secondary"><i class="fa-regular fa-envelope"></i></span>
                <input id="email" type="email" class="form-control" placeholder="voce@exemplo.com">
              </div>
              <div class="form-text tiny">Se o backend (SendGrid) estiver ativo, mandamos o roteiro em HTML.</div>
            </div>

            <!-- STEP 6 -->
            <div class="step hidden" data-step="6">
              <label class="form-label">Passo 6 — Revisão &amp; Gerar</label>
              <div class="d-flex flex-wrap gap-2 mb-2" id="reviewTags"></div>
              <div class="tiny">Conferiu tudo? Clique em <b>Gerar roteiro</b> para enviar à IA.</div>
            </div>

            <div id="alert" class="alert alert-danger d-none" role="alert"></div>

            <div class="d-grid d-md-flex gap-2 mt-2">
              <button id="btnBack" class="btn btn-outline-light" type="button">
                <i class="fa-solid fa-arrow-left-long me-1"></i>Voltar
              </button>
              <button id="btnNext" class="btn btn-primary" type="button">
                <i class="fa-solid fa-arrow-right-long me-1"></i>Avançar
              </button>
              <button id="btnGenerate" class="btn btn-success hidden" type="button">
                <i class="fa-solid fa-wand-magic-sparkles me-1"></i>Gerar roteiro
              </button>
              <button id="btnReset" class="btn btn-outline-light ms-auto" type="button">
                <i class="fa-regular fa-trash-can me-1"></i>Limpar
              </button>
            </div>
          </form>

          <div class="mt-3">
            <div class="tiny">Resumo rápido</div>
            <div id="liveTags" class="d-flex flex-wrap gap-2 tiny"></div>
          </div>
        </div>
      </div>

      <!-- RESULT -->
      <div class="col-lg-7" data-aos="fade-up" data-aos-delay="100">
        <div class="card p-3 p-md-4">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-3"><i class="fa-solid fa-list-check me-2 text-success"></i>Resultado</h5>
            <div class="toolbar d-flex gap-2">
              <button id="btnCopy" class="btn btn-outline-light btn-sm" title="Copiar"><i class="fa-regular fa-copy me-1"></i>Copiar</button>
              <button id="btnDownload" class="btn btn-outline-light btn-sm" title="Baixar .md"><i class="fa-solid fa-download me-1"></i>.md</button>
            </div>
          </div>

          <!-- skeleton -->
          <div id="skeleton" class="skeleton d-none" aria-hidden="true">
            <div class="sk-line thick mt-3 mx-3"></div>
            <div class="sk-line mid"></div>
            <div class="sk-line"></div>
            <div class="sk-line short"></div>
            <div class="sk-line thick mt-4 mx-3"></div>
            <div class="sk-line mid"></div>
            <div class="sk-line"></div>
            <div class="sk-line short"></div>
          </div>

          <div id="progressBox" class="d-none">
            <div class="progress fake" role="progressbar" aria-valuemin="0" aria-valuemax="100">
              <div class="progress-bar progress-bar-striped progress-bar-animated" style="width:20%"></div>
            </div>
            <div class="tiny mt-2"><i class="fa-regular fa-clock me-1"></i>Aguarde — montando seu roteiro…</div>
          </div>

          <article id="result" class="md-out" style="min-height:220px">
            <p>Conclua o assistente e gere seu roteiro.</p>
          </article>
        </div>
      </div>
    </div>
  </main>

  <footer class="container text-center py-4 tiny" data-aos="fade-in">
    <span>© Touristando IA — interface de demonstração</span>
  </footer>

  <!-- Toast (feedback) -->
  <div class="position-fixed top-0 end-0 p-3" style="z-index:1080">
    <div id="toast" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastText">Pronto!</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- Back to top -->
  <button id="backTop" class="btn btn-outline-light btn-sm rounded-pill"><i class="fa-solid fa-arrow-up"></i></button>

  <!-- jQuery + Bootstrap Bundle -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Marked (Markdown -> HTML) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- AOS -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>

  <script>
    // ========= AOS =========
    AOS.init({ duration: 800, easing: 'ease-out-cubic', once: true, offset: 80 });

    // ========= refs =========
    const $wizard = $('#wizard');
    const $steps = $('.step');
    const totalSteps = $steps.length;
    const $stepNow = $('#stepNow'), $stepTotal = $('#stepTotal');
    const $progressBar = $('#progressBar');
    const $btnBack = $('#btnBack'), $btnNext = $('#btnNext'), $btnGenerate = $('#btnGenerate'), $btnReset = $('#btnReset');
    const $alert = $('#alert'), $liveTags = $('#liveTags'), $reviewTags = $('#reviewTags');
    const $sk = $('#skeleton'), $progBox = $('#progressBox'), $res = $('#result');
    const $btnCopy = $('#btnCopy'), $btnDownload = $('#btnDownload');
    const toast = new bootstrap.Toast(document.getElementById('toast'), { delay: 2000 });

    const $pais = $('#pais'), $dias = $('#dias'), $orc = $('#orcamento'), $perfil = $('#perfil'), $email = $('#email');

    // ========= state =========
    let current = 1, isLoading = false;
    $stepTotal.text(totalSteps);

    // ========= helpers =========
    const mkTag = (icon, text) => $(`<span class="tag"><i class="${icon}"></i> ${text}</span>`);
    function updateSummary() {
      $liveTags.empty();
      if ($pais.val().trim())   $liveTags.append(mkTag('fa-solid fa-flag', $pais.val().trim()));
      const d = +($dias.val() || 0); if (d>0) $liveTags.append(mkTag('fa-regular fa-calendar', `${d} dia(s)`));
      const o = +($orc.val() || 0);  if (o>0) $liveTags.append(mkTag('fa-solid fa-coins', `R$ ${o.toLocaleString('pt-BR')}`));
      if ($perfil.val())         $liveTags.append(mkTag('fa-solid fa-user', $perfil.val()));
      if ($email.val().trim())   $liveTags.append(mkTag('fa-regular fa-envelope', $email.val().trim()));
    }
    [$pais,$dias,$orc,$perfil,$email].forEach($el => $el.on('input change', updateSummary));
    updateSummary();

    function setAlert(msg){ $alert.text(msg).removeClass('d-none').addClass('animate__animated animate__shakeX');
      setTimeout(()=> $alert.removeClass('animate__animated animate__shakeX'), 600); }
    function clearAlert(){ $alert.addClass('d-none').text(''); }

    function showStep(n){
      current = n;
      $steps.addClass('hidden');
      $steps.filter(`[data-step="${n}"]`).removeClass('hidden').addClass('animate__animated animate__fadeInUp');
      setTimeout(()=> $steps.removeClass('animate__animated animate__fadeInUp'), 400);
      $stepNow.text(n);
      // step dots
      $('.step-dot').each(function(){
        const i = +$(this).data('step');
        $(this).toggleClass('active', i<=n);
      });
      // progress %
      const pct = Math.max(16, Math.round((n-1)/(totalSteps-1)*100));
      $progressBar.css('width', pct+'%');
      // buttons
      $btnBack.prop('disabled', n===1 || isLoading);
      $btnNext.toggleClass('hidden', n===totalSteps);
      $btnGenerate.toggleClass('hidden', n!==totalSteps);
      clearAlert();
      buildReview();
      // focus
      setTimeout(()=> {
        const $input = $steps.filter(`[data-step="${n}"]`).find('input,select').first();
        $input.trigger('focus');
      }, 100);
    }

    function buildReview(){
      $reviewTags.empty();
      if(current!==6) return;
      if ($pais.val().trim())   $reviewTags.append(mkTag('fa-solid fa-flag', $pais.val().trim()));
      const d = +($dias.val() || 0); if (d>0) $reviewTags.append(mkTag('fa-regular fa-calendar', `${d} dia(s)`));
      const o = +($orc.val() || 0);  $reviewTags.append(mkTag('fa-solid fa-coins', o>0 ? `R$ ${o.toLocaleString('pt-BR')}` : 'Sem orçamento declarado'));
      if ($perfil.val())         $reviewTags.append(mkTag('fa-solid fa-user', $perfil.val()));
      $reviewTags.append(mkTag('fa-regular fa-envelope', $email.val().trim() || 'Não enviar por e-mail'));
    }

    function validateStep(n){
      if(n===1 && !$pais.val().trim()) { setAlert('Informe o país/destino.'); return false; }
      if(n===2){
        const d = +($dias.val()||0);
        if(!Number.isFinite(d) || d<=0){ setAlert('Informe um número de dias válido.'); return false; }
      }
      if(n===3){
        const v = $orc.val();
        if(v && +v<0){ setAlert('Orçamento não pode ser negativo.'); return false; }
      }
      if(n===5){
        const e = $email.val().trim();
        if(e && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)){ setAlert('E-mail inválido.'); return false; }
      }
      return true;
    }

    function nextStep(){ if(!isLoading && validateStep(current) && current<totalSteps) showStep(current+1); }
    function prevStep(){ if(!isLoading && current>1) showStep(current-1); }

    // ENTER => avançar (exceto no último)
    $wizard.on('keydown', 'input,select', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); (current<totalSteps? nextStep(): null); }});

    // buttons
    $btnNext.on('click', nextStep);
    $btnBack.on('click', prevStep);
    $btnReset.on('click', ()=>{
      if(isLoading) return;
      $wizard[0].reset();
      updateSummary(); clearAlert();
      showStep(1);
      $res.html('<p>Conclua o assistente e gere seu roteiro.</p>');
      window.scrollTo({top:0, behavior:'smooth'});
    });

    // ====== geração ======
    let progTimer=null;
    function setLoading(on){
      isLoading = on;
      $btnGenerate.prop('disabled', on);
      $btnNext.prop('disabled', on);
      $btnBack.prop('disabled', on || current===1);
      if(on){ $sk.removeClass('d-none'); $progBox.removeClass('d-none'); startFakeProgress(); }
      else  { $sk.addClass('d-none');   $progBox.addClass('d-none');   stopFakeProgress(); }
    }
    function startFakeProgress(){
      const bar = $('.progress-bar'); let w = 14;
      bar.css('width', w+'%');
      progTimer = setInterval(()=>{ w = Math.min(98, w + Math.random()*10); bar.css('width', w+'%'); }, 600);
    }
    function stopFakeProgress(){
      clearInterval(progTimer); progTimer=null; $('.progress-bar').css('width','100%');
      setTimeout(()=> $('.progress-bar').css('width', `${Math.max(16, Math.round((current-1)/(totalSteps-1)*100))}%`), 500);
    }

    async function generate(){
      if(!validateStep(6) || isLoading) return;
      const payload = {
        pais: $pais.val().trim(),
        dias: Number($dias.val() || 5),
        orcamento: $('#orcamento').val() ? Number($('#orcamento').val()) : null,
        perfil: $perfil.val(),
        emailDestino: $email.val().trim() || null
      };
      setLoading(true);
      $res.html('<p>Solicitando à IA…</p>');
      document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'start' });

      try{
        const resp = await fetch('/api/roteiro', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        const data = await resp.json();
        if(!resp.ok) throw new Error(data?.error || 'Falha ao gerar roteiro');

        const md = (data.texto || '').trim() || '(sem conteúdo)';
        marked.setOptions({ mangle:false, headerIds:false });
        const html = marked.parse(md);
        $res.html(html);
        $('#toastText').text('Roteiro gerado!');
        toast.show();
      }catch(err){
        setAlert(err.message || String(err));
        $res.html('<p class="text-danger">Não foi possível gerar o roteiro.</p>');
      }finally{
        setLoading(false);
      }
    }
    $btnGenerate.on('click', generate);

    // Ações do resultado
    $btnCopy.on('click', async ()=>{
      try{ await navigator.clipboard.writeText($res.text()); $('#toastText').text('Roteiro copiado!'); toast.show(); }
      catch(_){ setAlert('Não foi possível copiar.'); }
    });
    $btnDownload.on('click', ()=>{
      const content = $res.text() || '';
      const blob = new Blob([content], {type:'text/markdown;charset=utf-8'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
      const name = ($('#pais').val() || 'roteiro').toString().replace(/[^\w\-]+/g,'_');
      a.download = `roteiro_${name}.md`; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(a.href);
    });

    // Back to top
    const $backTop = $('#backTop');
    $(window).on('scroll', ()=> $backTop.toggle($(window).scrollTop()>300));
    $backTop.on('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

    // init
    showStep(1);
  </script>
</body>
</html>
